CREATE TABLE PELICULA (ID_PELICULA INTEGER, TITULO VARCHAR2(180), SINOPSIS VARCHAR2(400), CONSTRAINT PK_ID_PELICULA PRIMARY KEY (ID_PELICULA));

CREATE SEQUENCE SEC_PELICULA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE PROCEDURE ALMACENADO_PELICULA(MY_ID OUT INTEGER, MY_TITULO IN VARCHAR2, MY_SINOPSIS IN VARCHAR2)
AS
  BEGIN

  SELECT SEC_PELICULA.NEXTVAL INTO  MY_ID FROM DUAL;
  INSERT INTO PELICULA(ID_PELICULA, TITULO, SINOPSIS) VALUES(MY_ID, MY_TITULO, MY_SINOPSIS);
END;
/

SET SERVEROUTPUT ON;


DECLARE 
VALOR INTEGER;

BEGIN
ALMACENADO_PELICULA(VALOR,'GUERRA DE LOS MUNDOS','PELEA MUNDIAL');
DBMS_OUTPUT.PUT_LINE('SE INSERTO'||VALOR);
END;
/

SELECT * FROM PELICULA;

///////////////////////////////////////////////////
CREATE TABLE SALA (ID_SALA INTEGER, ID_PELICULA INTEGER, NUMERO_ASIENTOS INTEGER, CONSTRAINT PK_ID_SALA PRIMARY KEY (ID_SALA), CONSTRAINT FK_ID_PELICULA FOREIGN KEY(ID_PELICULA) REFERENCES PELICULA(ID_PELICULA));


CREATE SEQUENCE SEC_SALA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE PROCEDURE ALMACENADO_SALA(MY_ID OUT INTEGER, MY_ID_PELICULA IN INTEGER, MY_NUMERO_ASIENTOS IN INTEGER)
AS
  BEGIN

  SELECT SEC_SALA.NEXTVAL INTO  MY_ID FROM DUAL;
  INSERT INTO SALA(ID_SALA, ID_PELICULA, NUMERO_ASIENTOS) VALUES(MY_ID, MY_ID_PELICULA, MY_NUMERO_ASIENTOS);
END;
/

SET SERVEROUTPUT ON;


DECLARE 
VALOR INTEGER;

BEGIN
ALMACENADO_SALA(VALOR,2,400);
DBMS_OUTPUT.PUT_LINE('SE INSERTO'||VALOR);
END;
/

SELECT * FROM SALA;


/////////////////////

CREATE OR REPLACE PROCEDURE COMPARAR_BOLETOS(MY_ID_SALA IN INTEGER, MY_ID_PELICULA IN INTEGER, MY_NUMERO_ASIENTOS IN INTEGER, MY_BOLETOS_COMPRAR IN INTEGER)
AS

BEGIN

IF  MY_NUMERO_ASIENTOS < MY_BOLETOS_COMPRAR THEN

RAISE_APPLICATION_ERROR(-20001,'NO HAY SUFICIENTES ASIENTOS, SOLO QUEDAN ' || MY_NUMERO_ASIENTOS);

ELSE 

UPDATE SALA
SET NUMERO_ASIENTOS = MY_NUMERO_ASIENTOS - MY_BOLETOS_COMPRAR
where ID_SALA=MY_ID_SALA AND ID_PELICULA=MY_ID_PELICULA AND NUMERO_ASIENTOS=MY_NUMERO_ASIENTOS;


END IF;
END;


//////////////PARA PROBAR EL PROCEDIMIENTO DE COMPARAR BOLETOS


SET SERVEROUTPUT ON;

BEGIN
COMPARAR_BOLETOS(2,2,40,41);
END;
/






