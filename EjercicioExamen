MIO////////////////////////////
--1)
create table clientez(id_cliente integer, nombre_cliente varchar2(250), telefono varchar2(70),constraint pk_clientes primary key (id_cliente));
create table ordenez(id_orden integer, id_cliente integer,total float,constraint pk_orden primary key (id_orden), constraint fk_clientes foreign key (id_cliente) references clientez(id_cliente));

CREATE SEQUENCE SEC_CLIENTEZ
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE SEQUENCE SEC_ORDENEZ
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

SET SERVEROUTPUT ON;

--2)
CREATE OR REPLACE PROCEDURE crear_clientes(my_id_clientes out integer, my_nombre_cliente in varchar2,my_telefono in varchar2)
AS
BEGIN
SELECT SEC_CLIENTEZ.NEXTVAL INTO MY_ID_CLIENTES FROM DUAL;
INSERT INTO CLIENTEZ(ID_CLIENTE,NOMBRE_CLIENTE,TELEFONO)VALUES(MY_ID_CLIENTES,MY_NOMBRE_CLIENTE,MY_TELEFONO);
END;


DECLARE 
ID_CLIENTEZZ INTEGER;
BEGIN
FOR LLENADO IN 1..10 LOOP
CREAR_CLIENTES(ID_CLIENTEZZ,DBMS_RANDOM.string('l',8),'01-800-xxx');
END LOOP;
end;
/


--3)
CREATE OR REPLACE PROCEDURE CREAR_ORDENEZ(MY_ID_ORDEN OUT INTEGER,MY_ID_CLIENTE IN INTEGER,MY_TOTAL IN FLOAT)
AS
BEGIN
SELECT SEC_ORDENEZ.NEXTVAL INTO MY_ID_ORDEN FROM DUAL;
INSERT INTO ORDENEZ(ID_ORDEN,ID_CLIENTE,TOTAL)VALUES(MY_ID_ORDEN,MY_ID_CLIENTE,MY_TOTAL);
END;


DECLARE
ID_CORRE_ORDEN INTEGER;
CURSOR TOMA_CLIENTEZ IS SELECT * FROM CLIENTEZ;
BEGIN
FOR DAME IN TOMA_CLIENTEZ LOOP
FOR ORDENAR IN 1..3 LOOP
CREAR_ORDENEZ(ID_CORRE_ORDEN,DAME.ID_CLIENTE,ROUND(DBMS_RANDOM.VALUE(120,600)));
END LOOP;
END LOOP;
END;
/

SELECT * FROM ORDENEZ;



--4)

CREATE OR REPLACE PROCEDURE CORTE_DE_CAJA
AS
sunombre varchar2(80);
consumototal float;
descuentototal float;
idhelper integer;
AUXILIAR INTEGER;
CURSOR AYUDA_ORDENEZ IS SELECT * FROM ORDENEZ;
CURSOR AYUDA_FORCLIENTEZ IS SELECT * FROM CLIENTEZ;
BEGIN 
AUXILIAR:=0;
CONSUMOTOTAL:=0;
SELECT count(nombre_cliente) into AUXILIAR FROM CLIENTEZ;
DBMS_OUTPUT.PUT_LINE('  ' || ' NOMBRE ' || '   ' || 'CONSUMO TOTAL' || '  ' || ' TOTAL CON DESCUENTO');
IDHELPER:=1;
FOR IDHELPER IN 1..AUXILIAR LOOP
FOR SUMAR IN AYUDA_ORDENEZ LOOP
IF SUMAR.ID_CLIENTE = IDHELPER THEN
SELECT NOMBRE_CLIENTE INTO SUNOMBRE FROM CLIENTEZ WHERE ID_CLIENTE = IDHELPER;
CONSUMOTOTAL:= CONSUMOTOTAL + SUMAR.TOTAL;

IF CONSUMOTOTAL < 900 THEN
DESCUENTOTOTAL:= CONSUMOTOTAL - (CONSUMOTOTAL * 0.1);
ELSE
DESCUENTOTOTAL:= CONSUMOTOTAL - (CONSUMOTOTAL * 0.2);
END IF;
END IF;
END LOOP;
dbms_output.put_line('  ' || SUNOMBRE  ||'       '|| CONSUMOTOTAL ||'               '|| DESCUENTOTOTAL);
CONSUMOTOTAL:=0;
END LOOP;
END;
/

BEGIN 
CORTE_DE_cAJA;
END;


